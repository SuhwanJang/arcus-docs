<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>1. getting started - ARCUS Documentation</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../custom/extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "1-1. Arcus", url: "#_top", children: [
          ]},
          {title: "1-2. \ubbf8\ub9ac \uc54c\uc544\ub450\uae30", url: "#1-2", children: [
          ]},
          {title: "1-3. Hello, Arcus!", url: "#1-3-hello-arcus", children: [
              {title: "pom.xml", url: "#pomxml" },
              {title: "HelloArcus.java", url: "#helloarcusjava" },
              {title: "\ud14c\uc2a4\ud2b8", url: "#_1" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <p>이 문서는 Arcus를 처음 접하는 자바 개발자를 위해 작성되었습니다.
<a href="http://maven.apache.org/" title="Apache Maven">Apache Maven</a>의 개념과 기본 사용법을 알고 있다고 가정하고 있으며,
자세한 설명을 하기 보다는 Copy&amp;Paste를 통해 Arcus를 사용해볼 수 있는 내용으로 되어 있습니다.</p>
<h2 id="1-1-arcus">1-1. Arcus</h2>
<p>Arcus는 오픈소스 key-value 캐시 서버인 memcached를 기반으로 부분적으로 fault-tolerant한 메모리 기반의 캐시 클라우드 입니다.
* memcached : 구글, 페이스북 등에서 대규모로 사용하고 있는 메모리 캐시 서버입니다.
* 캐시 : 자주 사용되는 데이터를 비교적 고속의 저장소에 넣어둠으로써, 느린 저장소로의 요청을 줄이고 보다 빠른 응답성을 기대할 수 있게 하는 서비스입니다.
* 메모리 기반 : Arcus는 데이터를 메모리에만 저장합니다. 따라서 모든 데이터는 휘발성이며 언제든지 삭제될 수 있습니다.
* 클라우드 : 각 서비스는 필요에 따라 전용 캐시 클러스터를 구성할 수 있으며 동적으로 캐시 서버를 추가하거나 삭제할 수 있습니다. (단, 일부 데이터는 유실됩니다)
* fault-tolerant : Arcus는 일부 또는 전체 캐시 서버의 이상 상태를 감지하여 적절한 조치를 취합니다.</p>
<p>또한 Arcus는 key-value 형태의 데이터뿐만 아니라 List, Set, Map, B+Tree 등의 자료구조를 저장할 수 있는 기능을 제공합니다.</p>
<h2 id="1-2">1-2. 미리 알아두기</h2>
<ul>
<li>키(key)<ul>
<li>Arcus의 key는 prefix와 subkey로 구성되며, prefix와 subkey는 콜론(:)으로 구분됩니다. (예) <em>users:user_12345</em></li>
<li>Arcus는 prefix를 기준으로 별도의 통계를 수집합니다. prefix 개수의 제한은 없으나 통계 수집을 하는 경우에는 너무 많지 않는 수준(5~10개)으로 생성하시는 것을 권합니다.</li>
<li>키는 prefix, subkey를 포함하여 250자를 넘을 수 없습니다. 따라서 반드시 응용에서 키 길이를 제한하셔야 합니다.</li>
</ul>
</li>
<li>값(value)<ul>
<li>하나의 키에 대한 값은 바이트 스트림 형태로 최대 1MB 까지 저장될 수 있습니다.</li>
<li>자바 객체를 저장하는 경우, 해당 객체는 반드시 Serializable 인터페이스를 구현해야 합니다.</li>
</ul>
</li>
<li>Arcus 접속 정보<ul>
<li>Arcus admin: ZooKeeper 서버 주소로서 캐시 서버들의 IP와 PORT 정보를 조회하고 변경이 있을 때 클라이언트에게 알려주는 역할을 합니다.</li>
<li>Arcus service code: 사용자 또는 서비스에게 할당된 캐시 서버들을 구분짓는 코드값입니다.</li>
</ul>
</li>
</ul>
<h2 id="1-3-hello-arcus">1-3. Hello, Arcus!</h2>
<p>기본적인 key-value 캐시 요청을 수행해보도록 하겠습니다. 아커스 서버가 구성되어 있다고 가정합니다.
우선 다음과 같이 비어 있는 자바 프로젝트를 생성합니다.</p>
<pre><code class="bash">$ mvn archetype:generate -DgroupId=com.navercorp.arcus -DartifactId=arcus-quick-start -DinteractiveMode=false
$ cd arcus-quick-start
$ mvn eclipse:eclipse // 이클립스 IDE를 사용하는 경우 실행하여 이클립스 프로젝트를 생성하여 활용합니다.
</code></pre>

<h3 id="pomxml">pom.xml</h3>
<p>프로젝트가 생성되면 pom.xml에서 Arcus 클라이언트를 참조하도록 변경합니다.</p>
<pre><code class="xml">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.navercorp.arcus&lt;/groupId&gt;
    &lt;artifactId&gt;arcus-quick-start&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;

    &lt;name&gt;arcus-quick-start&lt;/name&gt;
    &lt;url&gt;http://maven.apache.org&lt;/url&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;!-- 편의상 JUnit 버전을 4.x로 변경합니다. --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;4.4&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;!-- Arcus 클라이언트 의존성을 추가합니다. --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.navercorp.arcus&lt;/groupId&gt;
            &lt;artifactId&gt;arcus-java-client&lt;/artifactId&gt;
            &lt;version&gt;1.8.0&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- 로거 의존성을 추가합니다. --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;log4j&lt;/groupId&gt;
            &lt;artifactId&gt;log4j&lt;/artifactId&gt;
            &lt;version&gt;1.2.16&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
            &lt;version&gt;1.6.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
            &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
            &lt;version&gt;1.6.1&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre>

<h3 id="helloarcusjava">HelloArcus.java</h3>
<p>이제 Arcus와 통신하는 클래스를 생성해봅시다.
시나리오는 다음과 같습니다.
- HelloArcus.sayHello(): Arcus 캐시 서버에 "Hello, Arcus!" 값을 저장합니다.
- HelloArcus.listenHello(): Arcus 캐시 서버에 저장된 "Hello, Arcus!" 값을 읽어옵니다.</p>
<pre><code class="java">// HelloArcusTest.java
package com.navercorp.arcus;

import junit.framework.Assert;

import org.junit.Before;
import org.junit.Test;

public class HelloArcusTest {

    HelloArcus helloArcus = new HelloArcus(&quot;127.0.0.1:2181&quot;, &quot;test&quot;);

    @Before
    public void sayHello() {
        helloArcus.sayHello();
    }

    @Test
    public void listenHello() {
        Assert.assertEquals(&quot;Hello, Arcus!&quot;, helloArcus.listenHello());
    }

}
</code></pre>

<pre><code class="java">// HelloArcus.java
package com.navercorp.arcus;

import java.util.concurrent.Future;
import java.util.concurrent.TimeUnit;

import net.spy.memcached.ArcusClient;
import net.spy.memcached.ConnectionFactoryBuilder;

public class HelloArcus {

    private String arcusAdmin;
    private String serviceCode;
    private ArcusClient arcusClient;

    public HelloArcus(String arcusAdmin, String serviceCode) {
        this.arcusAdmin = arcusAdmin;
        this.serviceCode = serviceCode;

        // log4j logger를 사용하도록 설정합니다.
        // 코드에 직접 추가하지 않고 아래의 JVM 환경변수를 사용해도 됩니다.
        //   -Dnet.spy.log.LoggerImpl=net.spy.memcached.compat.log.Log4JLogger
        System.setProperty(&quot;net.spy.log.LoggerImpl&quot;, &quot;net.spy.memcached.compat.log.Log4JLogger&quot;);

        // Arcus 클라이언트 객체를 생성합니다.
        // - arcusAdmin : Arcus 캐시 서버들의 그룹을 관리하는 admin 서버(ZooKeeper)의 주소입니다.
        // - serviceCode : 사용자에게 할당된 Arcus 캐시 서버들의 집합에 대한 코드값입니다. 
        // - connectionFactoryBuilder : 클라이언트 생성 옵션을 지정할 수 있습니다.
        //
        // 정리하면 arcusAdmin과 serviceCode의 조합을 통해 유일한 캐시 서버들의 집합을 얻어 연결할 수 있는 것입니다.
        this.arcusClient = ArcusClient.createArcusClient(arcusAdmin, serviceCode, new ConnectionFactoryBuilder());
    }

    public boolean sayHello() {
        Future&lt;Boolean&gt; future = null;
        boolean setSuccess = false;

        // Arcus의 &quot;test:hello&quot; 키에 &quot;Hello, Arcus!&quot;라는 값을 저장합니다.
        // 그리고 Arcus의 거의 모든 API는 Future를 리턴하도록 되어 있으므로
        // 비동기 처리에 특화된 서버가 아니라면 반드시 명시적으로 future.get()을 수행하여
        // 반환되는 응답을 기다려야 합니다.
        future = this.arcusClient.set(&quot;test:hello&quot;, 600, &quot;Hello, Arcus!&quot;);

        try {
            setSuccess = future.get(700L, TimeUnit.MILLISECONDS);
        } catch (Exception e) {
            if (future != null) future.cancel(true);
            e.printStackTrace();
        }

        return setSuccess;
    }

    public String listenHello() {
        Future&lt;Object&gt; future = null;
        String result = &quot;Not OK.&quot;;

        // Arcus의 &quot;test:hello&quot; 키의 값을 조회합니다.
        // Arcus에서는 가능한 모든 명령에 명시적으로 timeout 값을 지정하도록 가이드 하고 있으며
        // 사용자는 set을 제외한 모든 요청에 async로 시작하는 API를 사용하셔야 합니다.
        future = this.arcusClient.asyncGet(&quot;test:hello&quot;);

        try {
            result = (String)future.get(700L, TimeUnit.MILLISECONDS);
        } catch (Exception e) {
            if (future != null) future.cancel(true);
            e.printStackTrace();
        }

        return result;
    }

}
</code></pre>

<h4 id="srctestresourceslog4jxml">src/test/resources/log4j.xml</h4>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE log4j:configuration PUBLIC &quot;&quot; &quot;log4j.dtd&quot;&gt;
&lt;log4j:configuration xmlns:log4j='http://jakarta.apache.org/log4j/'&gt;
    &lt;appender name=&quot;console&quot; class=&quot;org.apache.log4j.ConsoleAppender&quot;&gt;
        &lt;layout class=&quot;org.apache.log4j.PatternLayout&quot;&gt;
            &lt;param name=&quot;ConversionPattern&quot; value=&quot;%d{yyyy-MM-dd HH:mm:ss}[%-5p] (%F:%L) %m%n&quot; /&gt;
        &lt;/layout&gt;
    &lt;/appender&gt;

    &lt;!-- collection piped exist --&gt;
    &lt;logger name=&quot;net.spy.memcached.protocol.ascii.CollectionPipedExistOperationImpl&quot; additivity=&quot;false&quot;&gt;
        &lt;level value=&quot;DEBUG&quot; /&gt;
        &lt;appender-ref ref=&quot;console&quot; /&gt;
    &lt;/logger&gt;

    &lt;!-- set attributes --&gt;
    &lt;logger name=&quot;net.spy.memcached.protocol.ascii.SetAttrOperationImpl&quot; additivity=&quot;false&quot;&gt;
        &lt;level value=&quot;DEBUG&quot; /&gt;
        &lt;appender-ref ref=&quot;console&quot; /&gt;
    &lt;/logger&gt;

    &lt;!-- collection insert --&gt;
    &lt;logger name=&quot;net.spy.memcached.protocol.ascii.CollectionStoreOperationImpl&quot; additivity=&quot;false&quot;&gt;
        &lt;level value=&quot;DEBUG&quot; /&gt;
        &lt;appender-ref ref=&quot;console&quot; /&gt;
    &lt;/logger&gt;

    &lt;!-- collection get --&gt;
    &lt;logger name=&quot;net.spy.memcached.protocol.ascii.CollectionGetOperationImpl&quot; additivity=&quot;false&quot;&gt;
        &lt;level value=&quot;DEBUG&quot; /&gt;
        &lt;appender-ref ref=&quot;console&quot; /&gt;
    &lt;/logger&gt;

    &lt;!-- collection upsert --&gt;
    &lt;logger name=&quot;net.spy.memcached.protocol.ascii.CollectionUpsertOperationImpl&quot; additivity=&quot;false&quot;&gt;
        &lt;level value=&quot;DEBUG&quot; /&gt;
        &lt;appender-ref ref=&quot;console&quot; /&gt;
    &lt;/logger&gt;

    &lt;!-- collection update --&gt;
    &lt;logger name=&quot;net.spy.memcached.protocol.ascii.CollectionUpdateOperationImpl&quot; additivity=&quot;false&quot;&gt;
        &lt;level value=&quot;DEBUG&quot; /&gt;
        &lt;appender-ref ref=&quot;console&quot; /&gt;
    &lt;/logger&gt;

    &lt;!-- collection count --&gt;
    &lt;logger name=&quot;net.spy.memcached.protocol.ascii.CollectionCountOperationImpl&quot; additivity=&quot;false&quot;&gt;
        &lt;level value=&quot;DEBUG&quot; /&gt;
        &lt;appender-ref ref=&quot;console&quot; /&gt;
    &lt;/logger&gt;

    &lt;!-- define root --&gt;
    &lt;root&gt;
        &lt;level value=&quot;DEBUG&quot; /&gt;
        &lt;appender-ref ref=&quot;console&quot; /&gt;
    &lt;/root&gt;
&lt;/log4j:configuration&gt;
</code></pre>

<h3 id="_1">테스트</h3>
<p>위 예제는 127.0.0.1:2181 에 ZooKeeper 가 작동하고 있고 memcached 서버가 구동하고 있다고 가정합니다.
아직 준비가 안 되어 있다면, 다음 페이지 Running Test Cases 를 따라 준비합니다.</p>
<p>https://github.com/naver/arcus-java-client/blob/master/README.md</p>
<p>테스트가 통과하는지 확인해봅니다.</p>
<pre><code class="bash">$ mvn test
...
-------------------------------------------------------
 T E S T S
-------------------------------------------------------
...
Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 1.885s
[INFO] Finished at: Mon Dec 17 14:13:22 KST 2012
[INFO] Final Memory: 4M/81M
[INFO] ------------------------------------------------------------------------
</code></pre>

  <br>
</div>

<footer class="col-md-12 wm-page-content">

</footer>

</body>
</html>