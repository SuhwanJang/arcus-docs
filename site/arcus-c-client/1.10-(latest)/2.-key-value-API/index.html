<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>2. key value API - ARCUS Documentation</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <link href="../../../custom/extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "2-1. Key-Value Item \uc800\uc7a5", url: "#_top", children: [
          ]},
          {title: "2-2. Key-Value Item \uc870\ud68c", url: "#2-2-key-value-item", children: [
              {title: "Key-Value Item \uac12\uc758 \uc99d\uac10", url: "#key-value-item" },
          ]},
          {title: "2-3. Key-Value Item \uc0ad\uc81c", url: "#2-3-key-value-item", children: [
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <p>Key-value item은 하나의 key에 대해 하나의 value만을 저장하는 item이다.</p>
<p><strong>제약조건</strong>
- Key의 최대 크기는 250 character이다.
- Value는 최대 1Mb까지 저장할 수 있다.</p>
<h2 id="2-1-key-value-item">2-1. Key-Value Item 저장</h2>
<p>key-value item을 저장하는 API로 set, add, replace, prepend/append가 있다.</p>
<pre><code class="c">memcached_return_t memcached_set(memcached_st *ptr, const char *key, size_t key_length, 
                                 const char *value, size_t value_length, time_t expiration, uint32_t flags);
memcached_return_t memcached_add(memcached_st *ptr, const char *key, size_t key_length,
                                 const char *value, size_t value_length, time_t expiration, uint32_t flags);
memcached_return_t memcached_replace(memcached_st *ptr, const char *key, size_t key_length,
                                 const char *value, size_t value_length, time_t expiration, uint32_t flags);
</code></pre>

<ul>
<li>memcached_set: 주어진 key에 value를 저장한다.</li>
<li>memcached_add: 주어진 key가 존재하지 않을 경우에만 value를 저장한다.</li>
<li>memcached_replace: 주어진 key가 존재하는 경우에만 value를 저장한다.</li>
</ul>
<pre><code class="c">memcached_return_t memcached_prepend(memcached_st *ptr, const char *key, size_t key_length, 
                                     const char *value, size_t value_length, time_t expiration, uint32_t flags);
memcached_return_t memcached_append(memcached_st *ptr, const char *key, size_t key_length,
                                    const char *value, size_t value_length, time_t expiration, uint32_t flags);
</code></pre>

<ul>
<li>memcached_prepend: 주어진 key의 value에 새로운 데이터를 prepend한다.</li>
<li>memcached_append: 주어진 key의 value에 새로운 데이터를 append한다.</li>
</ul>
<p>Key-value item 저장 연산에서 주요 파라미터는 아래와 같다.
- expiration: key가 현재 시간부터 expire 될 때까지의 시간(초 단위). 시간이 30일을 초과하는 경우 expire 될 unix time을 입력한다.
  - 0: key가 expire 되지 않도록 설정한다.
       하지만 Arcus cache server의 메모리가 부족한 경우 LRU에 의해 언제든지 삭제될 수 있다.
  - -1: key를 sticky item으로 만든다. Sticky item은 expire 되지 않으며 LRU에 의해 삭제되지도 않는다.
- flags: value와는 별도로 저장할 수 있는 값으로서 Java client 등에서 내부적으로 사용하는 경우가 많으므로 사용하지 않기를 권한다.</p>
<h2 id="2-2-key-value-item">2-2. Key-Value Item 조회</h2>
<p>Key-value item을 조회하는 API는 두 가지가 있다.</p>
<pre><code class="C">char *             memcached_get(memcached_st *ptr, const char *key, size_t key_length, size_t *value_length,
                                 uint32_t *flags, memcached_return_t *error);
</code></pre>

<p>주어진 key에 대한 value를 조회한다. 반환된 결과는 NULL이 아닌 경우 반드시 free 해주어야 한다.</p>
<pre><code class="C">memcached_return_t memcached_mget(memcached_st *ptr, const char * const *keys,  const size_t *key_length,
                                  size_t number_of_keys);
char *             memcached_fetch(memcached_st *ptr, char *key, size_t *key_length, size_t *value_length,
                                  uint32_t *flags, memcached_return_t *error);
</code></pre>

<p><code>memcached_mget</code>은 주어진 key 배열에 대한 value들을 조회하는 요청을 보낸다.
keys 인자는 key pointer array이고, key_length 인자는 key length array이다.</p>
<p><code>memcached_fetch</code>는 mget 요청에 대한 결과를 하나씩 꺼내온다.
error 값이 MEMCACHED_END가 될 때까지 실행하면 되며, 그 이후에 fetch를 수행하면 MEMCACHED_NOTFOUND가 반환된다.</p>
<h3 id="key-value-item">Key-Value Item 값의 증감</h3>
<p>Key-value item에서 숫자형 value 값에 대해서만 아래 증감 연산을 수행할 수 있다.</p>
<pre><code class="c">memcached_return_t memcached_increment(memcached_st *ptr, const char *key, size_t key_length, 
                                       uint32_t offset, uint64_t *value)
memcached_return_t memcached_decrement(memcached_st *ptr, const char *key, size_t key_length,
                                       uint32_t offset, uint64_t *value)
</code></pre>

<p>주어진 key의 value를 offset 만큼 증가/감소 시킨다.
주어진 key가 존재하지 않으면, 오류를 낸다.</p>
<pre><code class="C">memcached_return_t memcached_increment_with_initial(memcached_st *ptr, const char *key, size_t key_length, 
                                                    uint64_t offset, uint64_t initial, uint32_t flags,
                                                    time_t expiration, uint64_t *value)
memcached_return_t memcached_decrement_with_initial(memcached_st *ptr, const char *key, size_t key_length,
                                                    uint64_t offset, uint64_t initial, uint32_t flags,
                                                    time_t expiration, uint64_t *value)
</code></pre>

<p>주어진 key의 value를 offset 만큼 증가/감소 시킨다.
주어진 key가 존재하지 않으면, initial 값으로 저장한다.</p>
<h2 id="2-3-key-value-item">2-3. Key-Value Item 삭제</h2>
<pre><code class="C">memcached_return_t memcached_delete(memcached_st *ptr, const char *key, size_t key_length, time_t expiration);
</code></pre>

<p>주어진 key를 삭제한다.
expiration 값이 0 이상으로 지정되면 key는 expiration 초 이후에 삭제된다.</p>

  <br>
</div>

<footer class="col-md-12 wm-page-content">

</footer>

</body>
</html>